# üîß **DIAGN√ìSTICO Y SOLUCI√ìN - Problema de Login Angular**

## üö® **PROBLEMA IDENTIFICADO**

El usuario puede hacer login pero **nunca se dirige al siguiente flujo del sistema**. Esto indica problemas en:

1. **Comunicaci√≥n CORS** entre Angular (puerto 4200) y Spring Boot (puerto 8083)
2. **Backend Spring Boot** no est√° corriendo o no responde
3. **Configuraci√≥n de rutas** o manejo de respuestas incorrecto
4. **Permisos/roles** no se est√°n mapeando correctamente

## üõ†Ô∏è **HERRAMIENTAS DE DIAGN√ìSTICO CREADAS**

### ‚úÖ **1. Componente Debug (/debug)**
- **Acceso**: `http://localhost:4200/debug`
- **Funci√≥n**: Prueba directa de conectividad con Spring Boot
- **Test incluidos**: 
  - Test de conexi√≥n general
  - Test de login con Admin, Teacher, Student
  - Muestra respuesta completa del servidor

### ‚úÖ **2. Login Mejorado (/login)**
- **Logging detallado** en consola del navegador
- **Manejo espec√≠fico de errores** por c√≥digo de estado
- **Botones de prueba** para cada credencial
- **Debug visual** del flujo de autenticaci√≥n

## üéØ **PASOS PARA DIAGNOSTICAR Y SOLUCIONAR**

### **PASO 1: Verificar que Spring Boot est√© corriendo**
```bash
# En una terminal separada
cd EstudiaM-s/demo
mvn spring-boot:run
```

**Deber√≠as ver:**
```
Started DemoApplication in XXXX seconds
Tomcat started on port 8083
```

### **PASO 2: Probar endpoints directamente**
```bash
# En otra terminal, probar conexi√≥n
curl -X POST http://localhost:8083/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"admin123"}'
```

**Si Spring Boot est√° funcionando correctamente, deber√≠as ver una respuesta JSON.**

### **PASO 3: Usar el componente Debug de Angular**
1. **Abrir navegador** en `http://localhost:4200/debug`
2. **Hacer clic en "Probar Conexi√≥n Backend"**
3. **Revisar resultado**:
   - ‚úÖ **Si funciona**: El backend responde correctamente
   - ‚ùå **Si falla**: Problema de conectividad o CORS

### **PASO 4: Probar el Login mejorado**
1. **Ir a** `http://localhost:4200/login`
2. **Abrir DevTools** del navegador (F12) ‚Üí pesta√±a Console
3. **Usar credenciales** de prueba (botones en la p√°gina)
4. **Revisar logs** en la consola del navegador

### **PASO 5: Verificar logs del backend**
En la terminal donde corre Spring Boot, revisa si hay errores relacionados con:
- CORS
- Autenticaci√≥n
- Base de datos
- Endpoints

## üîç **PROBLEMAS M√ÅS COMUNES Y SOLUCIONES**

### **‚ùå Error: CORS Policy**
**S√≠ntoma**: Error en consola del navegador sobre CORS
**Soluci√≥n**: Verificar que `WebConfig.java` tiene la configuraci√≥n CORS correcta

### **‚ùå Error: Connection Refused**
**S√≠ntoma**: Error 0, servidor no disponible
**Soluci√≥n**: Verificar que Spring Boot est√© corriendo en puerto 8083

### **‚ùå Error: 401 Unauthorized**
**S√≠ntoma**: Login falla con credenciales correctas
**Soluci√≥n**: Verificar credenciales en base de datos

### **‚ùå Login funciona pero no redirige**
**S√≠ntoma**: Login exitoso pero se queda en la misma p√°gina
**Soluci√≥n**: Problema en el mapeo de roles o rutas de Angular

## üß™ **CREDENCIALES DE PRUEBA CONFIRMADAS**

| Rol | Email | Contrase√±a | Comportamiento Esperado |
|-----|-------|------------|-------------------------|
| Admin | admin@example.com | admin123 | M√∫ltiples roles ‚Üí Select Dashboard |
| Teacher | prof@example.com | teacher123 | M√∫ltiples roles ‚Üí Select Dashboard |
| Student | student@example.com | student123 | Solo estudiante ‚Üí Directo a student/dashboard |

## üìä **FLUJO ESPERADO**

1. **Usuario hace login** ‚Üí Angular llama a `/api/auth/login`
2. **Spring Boot responde** ‚Üí JWT token + datos del usuario
3. **Angular procesa respuesta** ‚Üí Mapea roles y permisos
4. **Redirecci√≥n autom√°tica** ‚Üí Seg√∫n roles del usuario:
   - **M√∫ltiples roles** ‚Üí `/select-dashboard`
   - **Un solo rol** ‚Üí Dashboard espec√≠fico

## üöÄ **INSTRUCCIONES DE PRUEBA R√ÅPIDA**

### **Si el backend NO est√° corriendo:**
```bash
# Terminal 1: Backend
cd EstudiaM-s/demo
mvn spring-boot:run

# Terminal 2: Frontend  
cd EstudiaM-s/frontend
ng serve -o
```

### **Si el backend EST√Å corriendo pero el login no funciona:**

1. **Ir a** `http://localhost:4200/debug`
2. **Hacer clic en "Test Admin Login"**
3. **Copiar resultado** y enviarlo para an√°lisis

### **Si quieres probar con navegador m√≥vil:**
La aplicaci√≥n Angular es responsive, pero el backend Spring Boot debe permitir CORS desde cualquier origen.

## üì± **ACCESOS DIRECTOS PARA PRUEBAS**

- **Login**: http://localhost:4200/login
- **Debug**: http://localhost:4200/debug  
- **Select Dashboard**: http://localhost:4200/select-dashboard
- **Admin Dashboard**: http://localhost:4200/admin/dashboard
- **Teacher Dashboard**: http://localhost:4200/profesor/dashboard
- **Student Dashboard**: http://localhost:4200/student/dashboard

## üîß **CONFIGURACI√ìN ACTUAL CONFIRMADA**

### **Backend Spring Boot:**
- **Puerto**: 8083
- **CORS**: Configurado para Angular
- **Endpoints**: `/api/auth/login`, `/api/auth/me`, `/api/auth/logout`

### **Frontend Angular:**
- **Puerto**: 4200
- **Interceptors**: Configurados para JWT
- **Rutas**: Mapeadas id√©nticamente a URLs de Thymeleaf

### **Base de Datos MySQL:**
- **Host**: localhost
- **Puerto**: 3306
- **Credenciales**: root / luis123
- **Base**: webestudiantil

Con estas herramientas de diagn√≥stico, deber√≠as poder identificar exactamente d√≥nde est√° el problema y solucionarlo. üöÄ